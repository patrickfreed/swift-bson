<!DOCTYPE html>
<html lang="en">
  <head>
    <title>JSON-Interop  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="JSON-Interop  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          SwiftBSON 3.0.1 Docs
        </a>
         (99% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/mongodb/swift-bson">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Fmongodb.github.io%2Fswift-bson%2Fdocs%2FSwiftBSON%2Fdocsets%2FSwiftBSON.xml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">SwiftBSON Reference</a>
      <img class="carat" src="img/carat.png" />
      JSON-Interop  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="General%20Guides.html">General Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="bson-guide.html">BSON-Guide</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="json-interop.html">JSON-Interop</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="BSON%20Types.html">BSON Types</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSON.html">BSON</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONType.html">BSONType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONBinary.html">BSONBinary</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONBinary/Subtype.html">– Subtype</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONCode.html">BSONCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONCodeWithScope.html">BSONCodeWithScope</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONDBPointer.html">BSONDBPointer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONDecimal128.html">BSONDecimal128</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONDocument.html">BSONDocument</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONObjectID.html">BSONObjectID</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONRegularExpression.html">BSONRegularExpression</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONSymbol.html">BSONSymbol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONTimestamp.html">BSONTimestamp</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Encoding%20and%20Decoding%20BSON.html">Encoding and Decoding BSON</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder.html">BSONEncoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder/DateEncodingStrategy.html">– DateEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder/UUIDEncodingStrategy.html">– UUIDEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder/DataEncodingStrategy.html">– DataEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder.html">BSONDecoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder/DateDecodingStrategy.html">– DateDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder/UUIDDecodingStrategy.html">– UUIDDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder/DataDecodingStrategy.html">– DataDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/DataCodingStrategy.html">DataCodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/DateCodingStrategy.html">DateCodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/UUIDCodingStrategy.html">UUIDCodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CodingStrategyProvider.html">CodingStrategyProvider</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONCoderOptions.html">BSONCoderOptions</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Encoding%20and%20Decoding%20Extended%20JSON.html">Encoding and Decoding Extended JSON</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ExtendedJSONEncoder.html">ExtendedJSONEncoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ExtendedJSONEncoder/Format.html">– Format</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ExtendedJSONDecoder.html">ExtendedJSONDecoder</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Errors.html">Errors</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError.html">BSONError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError/InvalidArgumentError.html">– InvalidArgumentError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError/InternalError.html">– InternalError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError/LogicError.html">– LogicError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError/DocumentTooLargeError.html">– DocumentTooLargeError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Errors.html#/s:9SwiftBSON17BSONErrorProtocolP">BSONErrorProtocol</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='json-interoperability-guide' class='heading'>JSON Interoperability Guide</h1>

<p>It is often useful to convert data that was retrieved from MongoDB to JSON, either for producing a human readable 
version of it or for serving it up via a REST API. <a href="bsonspec.org">BSON</a> (the format that MongoDB uses to store data) 
supports more types than JSON does though, which means JSON alone can&rsquo;t represent BSON data losslessly. To solve this issue, you can convert your data to <a href="https://docs.mongodb.com/manual/reference/mongodb-extended-json/">Extended JSON</a>, 
which is a standard format of JSON used by the various drivers to represent BSON data in JSON that includes extra 
information indicating the BSON type of a given value. If preserving the type information isn&rsquo;t required, 
then Foundation&rsquo;s <code>JSONEncoder</code> and <code>JSONDecoder</code> can be used to convert the data to regular JSON, though not all 
BSON types currently support working with them (e.g. <code><a href="Structs/BSONBinary.html">BSONBinary</a></code>).</p>
<h2 id='extended-json' class='heading'>Extended JSON</h2>

<p>As mentioned above, Extended JSON is a form of JSON that preserves type information. There are two forms of extended JSON, and the form used determines how much extra type information is included in the JSON format for a given type.</p>

<p>The two formats of extended JSON are as follows:</p>

<ul>
<li><em>Relaxed Extended JSON</em> - A string format based on the JSON standard that describes BSON documents. 
Relaxed Extended JSON emphasizes readability and interoperability at the expense of type preservation.

<ul>
<li>example: <code>{&quot;d&quot;: 5.5}</code></li>
</ul></li>
<li><em>Canonical Extended JSON</em> - A string format based on the JSON standard that describes BSON documents. 
Canonical Extended JSON emphasizes type preservation at the expense of readability and interoperability.

<ul>
<li>example: <code>{&quot;d&quot;: {&quot;$numberDouble&quot;: 5.5}}</code></li>
</ul></li>
</ul>

<p>Here we can see the same data: a key, <code>&quot;i&quot;</code> with the value <code>1</code> represented in BSON, and two forms of Extended JSON</p>
<pre class="highlight plaintext"><code>// BSON
"0C0000001069000100000000"

// Relaxed Extended JSON
{"i": 1}

// Canonical Extended JSON
{"i": {"$numberInt":"1"}}
</code></pre>

<p>To see how all of the BSON types are represented in Canonical and Relaxed Extended JSON Format, see the documentation
<a href="https://docs.mongodb.com/manual/reference/mongodb-extended-json/#bson-data-types-and-associated-representations">here</a>. </p>

<p>A thorough example Canonical Extended JSON document and its relaxed counterpart can be found 
<a href="https://github.com/mongodb/specifications/blob/master/source/extended-json.rst#canonical-extended-json-example">here</a>.</p>
<h3 id='generating-and-parsing-extended-json-via-code-codable-code' class='heading'>Generating and Parsing Extended JSON via <code>Codable</code></h3>

<p>The <code><a href="Classes/ExtendedJSONEncoder.html">ExtendedJSONEncoder</a></code> and <code><a href="Classes/ExtendedJSONDecoder.html">ExtendedJSONDecoder</a></code> provide a way for any custom <code>Codable</code> classes to interact with 
canonical or relaxed extended JSON. They can be used just like <code>JSONEncoder</code> and <code>JSONDecoder</code>.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">encoder</span> <span class="o">=</span> <span class="kt">ExtendedJSONEncoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">decoder</span> <span class="o">=</span> <span class="kt">ExtendedJSONDecoder</span><span class="p">()</span>

<span class="kd">struct</span> <span class="kt">Person</span><span class="p">:</span> <span class="kt">Codable</span><span class="p">,</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int32</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">bobExtJSON</span> <span class="o">=</span> <span class="k">try</span> <span class="n">encoder</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="kt">Person</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">,</span> <span class="nv">age</span><span class="p">:</span> <span class="mi">25</span><span class="p">))</span> <span class="c1">// "{\"name\":\"Bob\",\"age\":25}}"</span>
<span class="k">let</span> <span class="nv">joe</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"{</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">Joe</span><span class="se">\"</span><span class="s">,</span><span class="se">\"</span><span class="s">age</span><span class="se">\"</span><span class="s">:34}}"</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</code></pre>

<p>The <code><a href="Classes/ExtendedJSONEncoder.html">ExtendedJSONEncoder</a></code> produces relaxed Extended JSON by default, but can be configured to produce canonical.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">bob</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">,</span> <span class="nv">age</span><span class="p">:</span> <span class="mi">25</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">encoder</span> <span class="o">=</span> <span class="kt">ExtendedJSONEncoder</span><span class="p">()</span>
<span class="n">encoder</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="o">.</span><span class="n">canonical</span>
<span class="k">let</span> <span class="nv">canonicalEncoded</span> <span class="o">=</span> <span class="k">try</span> <span class="n">encoder</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">bob</span><span class="p">)</span> <span class="c1">// "{\"name\":\"Bob\",\"age\":{\"$numberInt\":\"25\"}}"</span>
</code></pre>

<p>The <code><a href="Classes/ExtendedJSONDecoder.html">ExtendedJSONDecoder</a></code> accepts either format, or a mix of both:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">decoder</span> <span class="o">=</span> <span class="kt">ExtendedJSONDecoder</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">canonicalExtJSON</span> <span class="o">=</span> <span class="s">"{</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">Bob</span><span class="se">\"</span><span class="s">,</span><span class="se">\"</span><span class="s">age</span><span class="se">\"</span><span class="s">:{</span><span class="se">\"</span><span class="s">$numberInt</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">25</span><span class="se">\"</span><span class="s">}}"</span>
<span class="k">let</span> <span class="nv">canonicalDecoded</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">canonicalExtJSON</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span> <span class="c1">// bob</span>

<span class="k">let</span> <span class="nv">relaxedExtJSON</span> <span class="o">=</span> <span class="s">"{</span><span class="se">\"</span><span class="s">name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">Bob</span><span class="se">\"</span><span class="s">,</span><span class="se">\"</span><span class="s">age</span><span class="se">\"</span><span class="s">:25}}"</span>
<span class="k">let</span> <span class="nv">relaxedDecoded</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">relaxedExtJSON</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span><span class="p">)</span> <span class="c1">// bob</span>
</code></pre>
<h3 id='using-extended-json-with-vapor' class='heading'>Using Extended JSON with Vapor</h3>

<p>By default, <a href="https://docs.vapor.codes/4.0/">Vapor</a> uses <code>JSONEncoder</code> and <code>JSONDecoder</code> for encoding and decoding its <a href="https://docs.vapor.codes/4.0/content/"><code>Content</code></a> to and from JSON.
If you are interested in using the <code><a href="Classes/ExtendedJSONEncoder.html">ExtendedJSONEncoder</a></code> and <code><a href="Classes/ExtendedJSONDecoder.html">ExtendedJSONDecoder</a></code> in your 
Vapor app instead, you can set them as the default encoder and decoder and thereby allow your 
application to serialize and deserialize data to/from Extended JSON, rather than the default plain JSON. 
This is recommended because not all BSON types currently support working with <code>JSONEncoder</code> and <code>JSONDecoder</code> and 
also so that you can take advantage of the added type information.
From the <a href="https://docs.vapor.codes/4.0/content/#override-defaults">Vapor Documentation</a>: 
you can set the global configuration and change the encoders and decoders Vapor uses by default 
by doing something like this: </p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">encoder</span> <span class="o">=</span> <span class="kt">ExtendedJSONEncoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">decoder</span> <span class="o">=</span> <span class="kt">ExtendedJSONDecoder</span><span class="p">()</span>
<span class="kt">ContentConfiguration</span><span class="o">.</span><span class="n">global</span><span class="o">.</span><span class="nf">use</span><span class="p">(</span><span class="nv">encoder</span><span class="p">:</span> <span class="n">encoder</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">json</span><span class="p">)</span>
<span class="kt">ContentConfiguration</span><span class="o">.</span><span class="n">global</span><span class="o">.</span><span class="nf">use</span><span class="p">(</span><span class="nv">decoder</span><span class="p">:</span> <span class="n">decoder</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">json</span><span class="p">)</span>
</code></pre>

<p>in your <code>configure.swift</code>.</p>

<p>Note that in order for this to work, <code><a href="Classes/ExtendedJSONEncoder.html">ExtendedJSONEncoder</a></code> must conform to Vapor&rsquo;s <code>ContentEncoder</code> protocol, and <code><a href="Classes/ExtendedJSONDecoder.html">ExtendedJSONDecoder</a></code> must conform to Vapor&rsquo;s <code>ContentDecoder</code> protocol.</p>

<p>We&rsquo;ve added these conformances in our Vapor integration library <a href="https://github.com/mongodb/mongodb-vapor">MongoDBVapor</a>, which we highly recommend using if you want to use the driver with Vapor.</p>

<p>To see an example Vapor app using the driver via the integration library, check out <a href="https://github.com/mongodb/mongo-swift-driver/tree/main/Examples/VaporExample">Examples/VaporExample</a>.</p>
<h2 id='using-code-jsonencoder-code-and-code-jsondecoder-code-with-bson-types' class='heading'>Using <code>JSONEncoder</code> and <code>JSONDecoder</code> with BSON Types</h2>

<p>Currently, some BSON types (e.g. <code><a href="Structs/BSONBinary.html">BSONBinary</a></code>) do not support working with encoders and decoders other than those introduced in <code>swift-bson</code>, meaning Foundation&rsquo;s <code>JSONEncoder</code> and <code>JSONDecoder</code> will throw errors when encoding or decoding such types. There are plans to add general <code>Codable</code> support for all BSON types in the future, though. For now, only <code><a href="Structs/BSONObjectID.html">BSONObjectID</a></code> and any BSON types defined in Foundation or the standard library (e.g. <code>Date</code> or <code>Int32</code>) will work with other encoder/decoder pairs. If type information is not required in the output JSON and only types that include a general <code>Codable</code> conformance are included in your data, you can use <code>JSONEncoder</code> and <code>JSONDecoder</code> to produce and ingest JSON data.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">Foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSONObjectID</span><span class="p">(),</span> <span class="nv">date</span><span class="p">:</span> <span class="kt">Date</span><span class="p">(),</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="k">try</span> <span class="kt">JSONEncoder</span><span class="p">()</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span> <span class="c1">// "{\"x\":&lt;hexstring&gt;,\"date\":&lt;seconds since reference date&gt;,\"y\":3.5}"</span>
</code></pre>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2021 <a class="link" href="https://github.com/mongodb/swift-bson" target="_blank" rel="external">Neal Beeken, Nellie Spektor, Patrick Freed, and Kaitlin Mahar</a>. All rights reserved. (Last updated: 2021-03-31)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
