<!DOCTYPE html>
<html lang="en">
  <head>
    <title>BSON-Guide  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="BSON-Guide  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          SwiftBSON 3.0.1 Docs
        </a>
         (99% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/mongodb/swift-bson">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Fmongodb.github.io%2Fswift-bson%2Fdocs%2FSwiftBSON%2Fdocsets%2FSwiftBSON.xml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">SwiftBSON Reference</a>
      <img class="carat" src="img/carat.png" />
      BSON-Guide  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="General%20Guides.html">General Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="bson-guide.html">BSON-Guide</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="json-interop.html">JSON-Interop</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="BSON%20Types.html">BSON Types</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSON.html">BSON</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONType.html">BSONType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONBinary.html">BSONBinary</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONBinary/Subtype.html">– Subtype</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONCode.html">BSONCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONCodeWithScope.html">BSONCodeWithScope</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONDBPointer.html">BSONDBPointer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONDecimal128.html">BSONDecimal128</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONDocument.html">BSONDocument</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONObjectID.html">BSONObjectID</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONRegularExpression.html">BSONRegularExpression</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONSymbol.html">BSONSymbol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONTimestamp.html">BSONTimestamp</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Encoding%20and%20Decoding%20BSON.html">Encoding and Decoding BSON</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder.html">BSONEncoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder/DateEncodingStrategy.html">– DateEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder/UUIDEncodingStrategy.html">– UUIDEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONEncoder/DataEncodingStrategy.html">– DataEncodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder.html">BSONDecoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder/DateDecodingStrategy.html">– DateDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder/UUIDDecodingStrategy.html">– UUIDDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/BSONDecoder/DataDecodingStrategy.html">– DataDecodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/DataCodingStrategy.html">DataCodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/DateCodingStrategy.html">DateCodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/UUIDCodingStrategy.html">UUIDCodingStrategy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/CodingStrategyProvider.html">CodingStrategyProvider</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/BSONCoderOptions.html">BSONCoderOptions</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Encoding%20and%20Decoding%20Extended%20JSON.html">Encoding and Decoding Extended JSON</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ExtendedJSONEncoder.html">ExtendedJSONEncoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ExtendedJSONEncoder/Format.html">– Format</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/ExtendedJSONDecoder.html">ExtendedJSONDecoder</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Errors.html">Errors</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError.html">BSONError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError/InvalidArgumentError.html">– InvalidArgumentError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError/InternalError.html">– InternalError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError/LogicError.html">– LogicError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/BSONError/DocumentTooLargeError.html">– DocumentTooLargeError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Errors.html#/s:9SwiftBSON17BSONErrorProtocolP">BSONErrorProtocol</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='mongodb-bson-library' class='heading'>MongoDB BSON Library</h1>

<p>MongoDB stores and transmits data in the form of <a href="bsonspec.org">BSON</a> documents, and this library be used to work with such documents. The following is an example of some of the functionality provided as part of that:</p>
<pre class="highlight swift"><code><span class="c1">// Document construction.</span>
<span class="k">let</span> <span class="nv">doc</span><span class="p">:</span> <span class="kt">BSONDocument</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">,</span>
    <span class="s">"occupation"</span><span class="p">:</span> <span class="s">"Software Engineer"</span><span class="p">,</span>
    <span class="s">"projects"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">76</span><span class="p">,</span> <span class="s">"title"</span><span class="p">:</span> <span class="s">"Documentation"</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">]</span>
<span class="c1">// Reading from documents.</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"name"</span><span class="p">])</span> <span class="c1">// .string(Bob)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"projects"</span><span class="p">])</span> <span class="c1">// .array([.document({ "id": 76, "title": "Documentation" })])</span>

<span class="c1">// Document serialization and deserialization.</span>
<span class="kd">struct</span> <span class="kt">Person</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">occupation</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="k">try</span> <span class="kt">BSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">doc</span><span class="p">))</span> <span class="c1">// Person(name: "Bob", occupation: "Software Engineer")</span>
<span class="nf">print</span><span class="p">(</span><span class="k">try</span> <span class="kt">BSONEncoder</span><span class="p">()</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="kt">Person</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Ted"</span><span class="p">,</span> <span class="nv">occupation</span><span class="p">:</span> <span class="s">"Janitor"</span><span class="p">)))</span> <span class="c1">// { "name": "Ted", "occupation": "Janitor" }</span>
</code></pre>
<h2 id='bson-values' class='heading'>BSON values</h2>

<p>BSON values have many possible types, ranging from simple 32-bit integers to documents which store more BSON values themselves. To accurately model this, the driver defines the <code><a href="Enums/BSON.html">BSON</a></code> enum, which has a distinct case for each BSON type. For the more simple cases such as BSON null, the case has no associated value. For the more complex ones, such as documents, a separate type is defined that the case wraps. Where possible, the enum case will wrap the standard library/Foundation equivalent (e.g. <code>Double</code>, <code>String</code>, <code>Date</code>)</p>
<pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="kt">BSON</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="n">null</span><span class="p">,</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">document</span><span class="p">(</span><span class="kt">BSONDocument</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="kt">Double</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">datetime</span><span class="p">(</span><span class="kt">Date</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
    <span class="c1">// ...rest of the cases...</span>
<span class="p">}</span>
</code></pre>
<h3 id='initializing-a-code-bson-code' class='heading'>Initializing a <code><a href="Enums/BSON.html">BSON</a></code></h3>

<p>This enum can be instantiated directly like any other enum in the Swift language, but it also conforms to a number of <code>ExpressibleByXLiteral</code> protocols, meaning it can be instantiated directly from numeric, string, boolean, dictionary, and array literals.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">int</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1">// .int64(5) on 64-bit systems</span>
<span class="k">let</span> <span class="nv">double</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="mf">5.5</span> <span class="c1">// .double(5.5)</span>
<span class="k">let</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="s">"hello world"</span> <span class="c1">// .string("hello world")</span>
<span class="k">let</span> <span class="nv">bool</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="kc">false</span> <span class="c1">// .bool(false)</span>
<span class="k">let</span> <span class="nv">document</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">"y"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s">"z"</span><span class="p">:</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">1</span><span class="p">]]</span> <span class="c1">// .document({ "x": 5, "y": true, "z": { "x": 1 } })</span>
<span class="k">let</span> <span class="nv">array</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="p">[</span><span class="s">"1"</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">]</span> <span class="c1">// .array([.string("1"), .bool(true), .double(5.5)])</span>
</code></pre>

<p>All other cases must be initialized directly:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">date</span> <span class="o">=</span> <span class="kt">BSON</span><span class="o">.</span><span class="nf">datetime</span><span class="p">(</span><span class="kt">Date</span><span class="p">())</span>
<span class="k">let</span> <span class="nv">objectId</span> <span class="o">=</span> <span class="kt">BSON</span><span class="o">.</span><span class="nf">objectID</span><span class="p">()</span>
<span class="c1">// ...rest of cases...</span>
</code></pre>
<h3 id='unwrapping-a-code-bson-code' class='heading'>Unwrapping a <code><a href="Enums/BSON.html">BSON</a></code></h3>

<p>To get a <code><a href="Enums/BSON.html">BSON</a></code> value as a specific type, you can use <code>switch</code> or <code>if/guard case let</code> like any other enum in Swift:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">x</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">int32</span><span class="p">(</span><span class="n">int32</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"got an Int32: </span><span class="se">\(</span><span class="n">int32</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">objectID</span><span class="p">(</span><span class="n">oid</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"got an objectId: </span><span class="se">\(</span><span class="n">oid</span><span class="o">.</span><span class="n">hex</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"got something else"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">guard</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">=</span> <span class="n">y</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"y must be a double"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>While these methods are good for branching, sometimes it is useful to get just the value (e.g. for optional chaining, passing as a parameter, or returning from a function). For those cases, <code><a href="Enums/BSON.html">BSON</a></code> has computed properties for each case that wraps a type. These properties will return <code>nil</code> unless the underlying BSON value is an exact match to the return type of the property.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">BSONDocument</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">documents</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">arrayValue</span><span class="p">?</span><span class="o">.</span><span class="nf">compactMap</span><span class="p">({</span> <span class="nv">$0</span><span class="o">.</span><span class="n">documentValue</span> <span class="p">})</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"x is not an array"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">documents</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">BSON</span><span class="o">.</span><span class="nf">int64</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">int32Value</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">BSON</span><span class="o">.</span><span class="nf">int32</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">int32Value</span><span class="p">)</span> <span class="c1">// Int32(5)</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">BSON</span><span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">int64Value</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="nf">print</span><span class="p">(</span><span class="kt">BSON</span><span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">doubleValue</span><span class="p">)</span> <span class="c1">// Double(5.0)</span>
</code></pre>
<h3 id='converting-a-code-bson-code' class='heading'>Converting a <code><a href="Enums/BSON.html">BSON</a></code></h3>

<p>In some cases, especially when dealing with numbers, it may make sense to coerce a <code><a href="Enums/BSON.html">BSON</a></code>&lsquo;s wrapped value into a similar one. For those situations, there are several conversion methods defined on <code><a href="Enums/BSON.html">BSON</a></code> that will unwrap the underlying value and attempt to convert it to the desired type. If that conversion would be lossless, a non-<code>nil</code> value is returned. </p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">BSON</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="nf">toInt</span><span class="p">(),</span> <span class="k">let</span> <span class="nv">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="nf">toInt</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"provide two integer types"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="p">}</span>
<span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">)</span> <span class="c1">// 10</span>
<span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// 10</span>
<span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">)</span> <span class="c1">// 10</span>
<span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="o">.</span><span class="nf">int32</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="nv">y</span><span class="p">:</span> <span class="o">.</span><span class="nf">int64</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="c1">// 10</span>
<span class="nf">foo</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">5.01</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// error</span>
</code></pre>

<p>There are similar conversion methods for the other types, namely <code>toInt32()</code>, <code>toDouble()</code>, <code>toInt64()</code>, and <code>toDecimal128()</code>.</p>
<h3 id='using-a-code-bson-code-value' class='heading'>Using a <code><a href="Enums/BSON.html">BSON</a></code> value</h3>

<p><code><a href="Enums/BSON.html">BSON</a></code> conforms to a number of useful Foundation protocols, namely <code>Codable</code>, <code>Equatable</code>, and <code>Hashable</code>. This allows them to be compared, encoded/decoded, and used as keys in maps:</p>
<pre class="highlight swift"><code><span class="c1">// Codable conformance synthesized by compiler.</span>
<span class="kd">struct</span> <span class="kt">X</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">_id</span><span class="p">:</span> <span class="kt">BSON</span>
<span class="p">}</span>
<span class="c1">// Equatable</span>
<span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="s">"5"</span>
<span class="k">let</span> <span class="nv">y</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">let</span> <span class="nv">z</span><span class="p">:</span> <span class="kt">BSON</span> <span class="o">=</span> <span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="s">"5"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span> <span class="c1">// false</span>
<span class="nf">print</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span> <span class="c1">// true</span>
<span class="c1">// Hashable</span>
<span class="k">let</span> <span class="nv">map</span><span class="p">:</span> <span class="p">[</span><span class="kt">BSON</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"x"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
    <span class="nv">false</span><span class="p">:</span> <span class="s">"bool"</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span> <span class="s">"array"</span><span class="p">,</span>
    <span class="o">.</span><span class="nf">objectID</span><span class="p">():</span> <span class="s">"oid"</span><span class="p">,</span>
    <span class="o">.</span><span class="nv">null</span><span class="p">:</span> <span class="s">"null"</span><span class="p">,</span>
    <span class="o">.</span><span class="nv">maxKey</span><span class="p">:</span> <span class="s">"maxKey"</span>
<span class="p">]</span>
</code></pre>
<h2 id='documents' class='heading'>Documents</h2>

<p>BSON documents are the top-level structures that contain the aforementioned BSON values, and they are also BSON values themselves. The driver defines the <code><a href="Structs/BSONDocument.html">BSONDocument</a></code> struct to model this specific BSON type.</p>
<h3 id='initializing-documents' class='heading'>Initializing documents</h3>

<p>Like <code><a href="Enums/BSON.html">BSON</a></code>, <code><a href="Structs/BSONDocument.html">BSONDocument</a></code> can also be initialized by a dictionary literal. The elements within the literal must be <code><a href="Enums/BSON.html">BSON</a></code>s, so further literals can be embedded within the top level literal definition:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">x</span><span class="p">:</span> <span class="kt">BSONDocument</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"x"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s">"y"</span><span class="p">:</span> <span class="mf">5.5</span><span class="p">,</span>
    <span class="s">"z"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="o">.</span><span class="nf">datetime</span><span class="p">(</span><span class="kt">Date</span><span class="p">())]</span>
    <span class="p">]</span>
<span class="p">]</span>
</code></pre>

<p>Documents can also be initialized directly by passing in a <code>Data</code> containing raw BSON bytes:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">BSONDocument</span><span class="p">(</span><span class="nv">fromBSON</span><span class="p">:</span> <span class="kt">Data</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
</code></pre>

<p>Documents may be initialized from an <a href="https://docs.mongodb.com/manual/reference/mongodb-extended-json/">extended JSON</a> string as well:</p>
<pre class="highlight swift"><code><span class="k">try</span> <span class="kt">BSONDocument</span><span class="p">(</span><span class="nv">fromJSON</span><span class="p">:</span> <span class="s">"{ </span><span class="se">\"</span><span class="s">x</span><span class="se">\"</span><span class="s">: true }"</span><span class="p">)</span> <span class="c1">// { "x": true }</span>
<span class="k">try</span> <span class="kt">BSONDocument</span><span class="p">(</span><span class="nv">fromJSON</span><span class="p">:</span> <span class="s">"{ x: false }}}"</span><span class="p">)</span> <span class="c1">// error</span>
</code></pre>
<h3 id='using-documents' class='heading'>Using documents</h3>

<p>Documents define the interface in which an application communicates with a MongoDB deployment. For that reason, <code><a href="Structs/BSONDocument.html">BSONDocument</a></code> has been fitted with functionality to make it both powerful and ergonomic to use for developers.</p>
<h4 id='reading-writing-to-code-bsondocument-code' class='heading'>Reading / writing to <code><a href="Structs/BSONDocument.html">BSONDocument</a></code></h4>

<p><code><a href="Structs/BSONDocument.html">BSONDocument</a></code> conforms to <a href="https://developer.apple.com/documentation/swift/collection"><code>Collection</code></a>, which allows for easy reading and writing of elements via the subscript operator. On <code><a href="Structs/BSONDocument.html">BSONDocument</a></code>, this operator returns and accepts a <code>BSON?</code>:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">doc</span><span class="p">:</span> <span class="kt">BSONDocument</span> <span class="o">=</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">])</span> <span class="c1">// .int64(1)</span>
<span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">"y"</span><span class="p">:</span> <span class="o">.</span><span class="n">null</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">])</span> <span class="c1">// .document({ "y": null })</span>
<span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"x"</span><span class="p">])</span> <span class="c1">// nil</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="c1">// { }</span>
</code></pre>

<p><code><a href="Structs/BSONDocument.html">BSONDocument</a></code> also has the <code>@dynamicMemberLookup</code> attribute, meaning it&rsquo;s values can be accessed directly as if they were properties on <code><a href="Structs/BSONDocument.html">BSONDocument</a></code>:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">doc</span><span class="p">:</span> <span class="kt">BSONDocument</span> <span class="o">=</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1">// .int64(1)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s">"y"</span><span class="p">:</span> <span class="o">.</span><span class="n">null</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1">// .document({ "y": null })</span>
<span class="n">doc</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">nil</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1">// nil</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="c1">// { }</span>
</code></pre>

<p><code><a href="Structs/BSONDocument.html">BSONDocument</a></code> also conforms to <a href="https://developer.apple.com/documentation/swift/sequence"><code>Sequence</code></a>, which allows it to be iterated over:</p>
<pre class="highlight swift"><code><span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">in</span> <span class="n">doc</span> <span class="p">{</span> 
    <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">k</span><span class="se">)</span><span class="s"> = </span><span class="se">\(</span><span class="n">v</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Conforming to <code>Sequence</code> also gives a number of useful methods from the functional programming world, such as <code>map</code> or <code>allSatisfy</code>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">allEvens</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">allSatisfy</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">v</span><span class="o">.</span><span class="nf">toInt</span><span class="p">()</span> <span class="p">??</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span>
<span class="k">let</span> <span class="nv">squares</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">v</span><span class="o">.</span><span class="nf">toInt</span><span class="p">()</span><span class="o">!</span> <span class="o">*</span> <span class="n">v</span><span class="o">.</span><span class="nf">toInt</span><span class="p">()</span><span class="o">!</span> <span class="p">}</span>
</code></pre>

<p>See the documentation for <code>Sequence</code> for a full list of methods that <code><a href="Structs/BSONDocument.html">BSONDocument</a></code> implements as part of this.</p>

<p>In addition to those protocol conformances, there are a few one-off helpers implemented on <code><a href="Structs/BSONDocument.html">BSONDocument</a></code> such as <code>filter</code> (that returns a <code><a href="Structs/BSONDocument.html">BSONDocument</a></code>) and <code>mapValues</code> (also returns a <code><a href="Structs/BSONDocument.html">BSONDocument</a></code>):</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">doc</span><span class="p">:</span> <span class="kt">BSONDocument</span> <span class="o">=</span> <span class="p">[</span><span class="s">"_id"</span><span class="p">:</span> <span class="o">.</span><span class="nf">objectID</span><span class="p">(),</span> <span class="s">"numCats"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">"numDollars"</span><span class="p">:</span> <span class="mf">1.56</span><span class="p">,</span> <span class="s">"numPhones"</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">doc</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">k</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"num"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">v</span><span class="o">.</span><span class="nf">toInt</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">}</span><span class="o">.</span><span class="n">mapValues</span> <span class="p">{</span> <span class="n">v</span> <span class="k">in</span> <span class="o">.</span><span class="nf">int64</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="nf">toInt64</span><span class="p">()</span><span class="o">!</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// { "numCats": 7, "numPhones": 6 }</span>
</code></pre>

<p>See the driver&rsquo;s documentation for a full listing of <code><a href="Structs/BSONDocument.html">BSONDocument</a></code>&rsquo;s public API.</p>
<h2 id='code-codable-code-and-code-bsondocument-code' class='heading'><code>Codable</code> and <code><a href="Structs/BSONDocument.html">BSONDocument</a></code></h2>

<p><a href="https://developer.apple.com/documentation/swift/codable"><code>Codable</code></a> is a protocol defined in Foundation that allows for ergonomic conversion between various serialization schemes and Swift data types. As part of the BSON library, MongoSwift defines both <code><a href="Classes/BSONEncoder.html">BSONEncoder</a></code> and <code><a href="Classes/BSONDecoder.html">BSONDecoder</a></code> to facilitate this serialization and deserialization to and from BSON via <code>Codable</code>. This allows applications to work with BSON documents in a type-safe way, and it removes much of the runtime key presence and type checking required when working with raw documents. It is reccommended that users leverage <code>Codable</code> wherever possible in their applications that use the driver instead of accessing documents directly. </p>

<p>For example, here is an function written using raw documents:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">person</span><span class="p">:</span> <span class="kt">BSONDocument</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"name"</span><span class="p">:</span> <span class="s">"Bob"</span><span class="p">,</span>
    <span class="s">"occupation"</span><span class="p">:</span> <span class="s">"Software Engineer"</span><span class="p">,</span>
    <span class="s">"projects"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"title"</span><span class="p">:</span> <span class="s">"Server Side Swift Application"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">76</span><span class="p">,</span> <span class="s">"title"</span><span class="p">:</span> <span class="s">"Write documentation"</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">]</span>

<span class="kd">func</span> <span class="nf">prettyPrint</span><span class="p">(</span><span class="nv">doc</span><span class="p">:</span> <span class="kt">BSONDocument</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"name"</span><span class="p">]?</span><span class="o">.</span><span class="n">stringValue</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"missing name"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Name: </span><span class="se">\(</span><span class="n">name</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">occupation</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"occupation"</span><span class="p">]?</span><span class="o">.</span><span class="n">stringValue</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"missing occupation"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Occupation: </span><span class="se">\(</span><span class="n">occupation</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">projects</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s">"projects"</span><span class="p">]?</span><span class="o">.</span><span class="n">arrayValue</span><span class="p">?</span><span class="o">.</span><span class="nf">compactMap</span><span class="p">({</span> <span class="nv">$0</span><span class="o">.</span><span class="n">documentValue</span> <span class="p">})</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"missing projects"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Projects:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">project</span> <span class="k">in</span> <span class="n">projects</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">title</span> <span class="o">=</span> <span class="n">project</span><span class="p">[</span><span class="s">"title"</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"missing title"</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Due to the flexible nature of <code><a href="Structs/BSONDocument.html">BSONDocument</a></code>, a number of checks have to be put into the body of the function. This clutters the actual function&rsquo;s logic and requires a lot of boilerplate code. Now, consider the following function which does the same thing but is written leveraging <code>Codable</code>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">Project</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">BSON</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Person</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">occupation</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">projects</span><span class="p">:</span> <span class="p">[</span><span class="kt">Project</span><span class="p">]</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">prettyPrint</span><span class="p">(</span><span class="nv">doc</span><span class="p">:</span> <span class="kt">BSONDocument</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">person</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">BSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">doc</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Name: </span><span class="se">\(</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Occupation: </span><span class="se">\(</span><span class="n">person</span><span class="o">.</span><span class="n">occupation</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Projects:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">project</span> <span class="k">in</span> <span class="n">person</span><span class="o">.</span><span class="n">projects</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>In this version, the definition of the data type and the logic of the function are defined completely separately, and it leads to far more readable and concise versions of both. </p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2021 <a class="link" href="https://github.com/mongodb/swift-bson" target="_blank" rel="external">Neal Beeken, Nellie Spektor, Patrick Freed, and Kaitlin Mahar</a>. All rights reserved. (Last updated: 2021-03-31)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
